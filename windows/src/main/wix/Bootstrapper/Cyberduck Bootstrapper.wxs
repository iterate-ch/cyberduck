<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:bal="http://wixtoolset.org/schemas/v4/wxs/bal" xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">
  <Bundle Name="Cyberduck" Version="!(bind.packageVersion.Setup)" Manufacturer="iterate GmbH" UpgradeCode="69C1D059-4B45-4220-A82C-DAE80C9CD8E0" IconSourceFile="$(var.CyberduckDir)cyberduck-application.ico">
    <BootstrapperApplication>
      <bal:WixStandardBootstrapperApplication LicenseUrl="" LogoFile="$(var.SetupDir)banner.png" LogoSideFile="$(var.SetupDir)welcome.bmp" ThemeFile="InstallerTheme.xml" Theme="hyperlinkSidebarLicense" />
    </BootstrapperApplication>
    <Variable Name="InstallFolder" Type="formatted" Value="[ProgramFiles64Folder]Cyberduck" />
    <Variable Name="InstallBonjour" bal:Overridable="yes" Type="numeric" Value="1" />

    <!-- Do search for Bonjour Upgrade Code -->
    <util:ProductSearch Id="HasBonjour" UpgradeCode="{46AE3251-43D6-41CF-8CDF-E902C38516D1}" Variable="Bonjour_VERSION64" Condition="InstallBonjour=0" />
    <util:ProductSearch After="HasBonjour" Condition="Bonjour_VERSION64" UpgradeCode="{46AE3251-43D6-41CF-8CDF-E902C38516D1}" Variable="InstallBonjour" />

    <util:RegistrySearch Id="PreviousInstallFolderSearch" Root="HKLM" Key="Software\[WixBundleManufacturer]\[WixBundleName]" Value="InstallDir" Variable="PreviousInstallFolder" />
    <util:RegistrySearch Id="CurrentBuild" Variable="CBNumber" Result="value" Root="HKLM" Key="SOFTWARE\Microsoft\Windows NT\CurrentVersion" Value="CurrentBuildNumber" />
    <util:DirectorySearch Path="[PreviousInstallFolder]" Variable="InstallFolder" After="PreviousInstallFolderSearch" Condition="PreviousInstallFolder" />

    <bal:Condition Message="Windows 10 Anniversary Update (14393) or later is required to run this application." Condition="VersionNT &gt;= v10.0 AND CBNumber &gt;= 14393" />

    <Chain>
      <PackageGroupRef Id="NetFx472Web" />
      <RollbackBoundary />
      <MsiPackage Id="Setup" Compressed="yes" SourceFile="$(Cyberduck.Bundle.TargetPath)" Vital="yes">
        <MsiProperty Name="INSTALLFOLDER" Value="[InstallFolder]" />
      </MsiPackage>
      <MsiPackage SourceFile="$(var.SetupDir)Bonjour64.msi" Compressed="yes" Permanent="yes" Visible="yes" Vital="no" InstallCondition="NOT InstallBonjour=0" />
    </Chain>
  </Bundle>
</Wix>
